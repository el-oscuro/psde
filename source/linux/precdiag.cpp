//*****************************************************************************           //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//                                                                                        //04-01-97|0x001e
// PRECEDENCE DIAGNOSTIC MANAGER                                                          //04-01-97|0x001e
//                                                                                        //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//  Copyright: 2006 Robert H. Adams                                                       //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//  The purpose of this program as well as instructions regarding its use is              //04-01-97|0x001e
//  defined in the associated manual.                                                     //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//  This program is free software; you can redistribute it and/or modify                  //04-01-97|0x001e
//  it under the terms of the GNU General Public License as published by                  //04-01-97|0x001e
//  the Free Software Foundation; either version 2 of the License, or                     //04-01-97|0x001e
//  (at your option) any later version.                                                   //04-01-97|0x001e
//                                                                                        //04-01-97|0x001e
//  This program is distributed in the hope that it will be useful,                       //04-01-97|0x001e
//  but WITHOUT ANY WARRANTY; without even the implied warranty of                        //04-01-97|0x001e
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                         //04-01-97|0x001e
//  GNU General Public License for more details.                                          //04-01-97|0x001e
//                                                                                        //04-01-97|0x001e
//  You should have received a copy of the GNU General Public License                     //04-01-97|0x001e
//  along with this program; if not, write to the Free Software                           //04-01-97|0x001e
//  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA., 02110-1301            //04-01-97|0x001e
//  USA                                                                                   //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//  For further information, please contact Robert Adams:                                 //04-01-97|0x001e
//     EMail:    robert.adams@whatifwe.com                                                //04-01-97|0x001e
//     Mail:     PO Box 156, Sun Valley, Ca. 91353-0155, USA                              //04-01-97|0x001e
//  Or visit the website, "www.whatifwe.com".                                             //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
//*****************************************************************************           //04-01-97|0x001e
#ifdef WIN31_SYSTEM                                                                       //05-24-97|0x0021
#include "precwn31.h"                                                                     //05-24-97|0x0021
#endif                                                                                    //05-24-97|0x0021
#ifdef WIN95_SYSTEM                                                                       //05-24-97|0x0021
#include "precwn95.h"                                                                     //05-24-97|0x0021
#endif                                                                                    //05-24-97|0x0021
#ifdef MSDOS_SYSTEM                                                                       //05-24-97|0x0021
#include "precdos.h"                                                                      //05-24-97|0x0021
#endif                                                                                    //05-24-97|0x0021
#include "prechost.h"                                                                     //05-24-97|0x0021
#include "precdiag.h"                                                                     //06-08-23|0x0021
#include "precdiag.hxx"                                                                   //06-08-23|0x0021
#include "precdiag.hpp"                                                                   //06-08-23|0x0021
#include "precutil.h"                                                                      //06-08-23|0x0024
#include "guicomm.h"                                                                      //06-08-23|0x0025
#include "preccall.h"                                                                     //07-02-10|0x0026
#define StrLen(i) strlen(i)                                                               //06-08-23|0x002e
#define StrCat(i,j) strcat(i,j)                                                           //06-08-23|0x002e
#define StrCpy(i,j) strcpy(i,j)                                                           //06-08-23|0x002e
#define StrCmp(i,j) Str_Comp((SCHAR_FAR)i,j,256)                                          //06-08-23|0x002e
#define StrRChr(i,j) strrchr(i,j)                                                         //06-08-23|0x002e
#define StrChr(i,j) strchr(i,j)                                                           //06-08-23|0x002e
#define StrToByteInt(i,j) GetInteger(i,&j,0xff)                                           //06-08-23|0x002e
#define StrToInt(i,j) GetInteger(i,&j,0xffff)                                             //06-08-23|0x002e
#define StrToLongInt(i,j) GetInteger(i,&j,0xffffffffL)                                    //06-08-23|0x002e
#define StrToByteHex(i,j) GetHex(i,&j,1)                                                  //06-08-23|0x002e
#define StrToHex(i,j) GetHex(i,&j,2)                                                      //06-08-23|0x002e
#define StrToLongHex(i,j) GetHex(i,&j,4)                                                  //06-08-23|0x002e
#define FindName(i) strrchr(i, '/')                                                       //06-08-23|0x002e
#define Allocate(k) (k##_FAR) calloc(1,sizeof(k))                                         //07-02-19|0x002f
#define Free(k) free(k)                                                                   //07-02-19|0x002f
#define MemSet(i,j,k) memset(i,j,k)                                                       //07-02-19|0x002f
#define MemCCpy(i,j,k,l) Mem_C_Copy((UCHAR_FAR) i, (UCHAR_FAR) j,k,l)                     //07-02-19|0x002f
#define MemCpy(i,j,k) memcpy(i,j,k)                                                       //07-02-19|0x002f
#define LineEnd 0x0d                                                                      //07-02-19|0x002f
//***************************************************************************             //06-08-23|0x003a
//***************************************************************************             //06-08-23|0x003b
//******                                                               ******             //06-08-23|0x003c
//******                   CLASS BEGIN                                 ******             //06-08-23|0x003d
//******                                                               ******             //06-08-23|0x003e
//***************************************************************************             //06-08-23|0x003f
//***************************************************************************             //06-08-23|0x0040
PRECDIAG prec_diag;                                                                       //04-09-24|0x0041
//***************************************************************************             //04-09-24|0x0042
//***************************************************************************             //04-09-24|0x0043
//******                                                               ******             //04-09-24|0x0044
//******                   diagnostic_file_names                       ******             //04-09-24|0x0045
//******                                                               ******             //04-09-24|0x0046
//***************************************************************************             //04-09-24|0x0047
//***************************************************************************             //04-09-24|0x0048
//***************************************************************************             //04-09-24|0x004f
//***************************************************************************             //04-09-24|0x0050
//*******************************************************************************         //10-29-97|0x0051
//*******************************************************************************         //10-29-97|0x0051
// diagnostic_file_names                                                                  //04-09-24|0x0051
//*******************************************************************************         //10-29-97|0x0051
//*******************************************************************************         //10-29-97|0x0051
void PRECDIAG::diagnostic_file_names(                                                     //04-09-24|0x0051
    SCHAR_FAR file_name                                                                   //04-09-24|0x0051
    ) {                                                                                   //04-09-24|0x0051
//*******************************************************************************         //10-29-97|0x0051
//***************************************************************************             //04-09-24|0x0053
//***************************************************************************             //04-09-24|0x0054
  SCHAR_FAR period_addr;                                                                  //04-09-24|0x0055
  FILE * file;                                                                            //04-09-27|0x0056
//***************************************************************************             //04-09-24|0x0057
    StrCpy(base_name, file_name);                                                         //04-09-24|0x0058
//***************************************************************************             //04-09-24|0x0059
    sprintf(error_name,  "%s.err", base_name);                                            //04-09-24|0x005a
    sprintf(test_name,   "%s.tst", base_name);                                            //04-09-27|0x005b
    sprintf(report_name, "%s.rpt", base_name);                                            //04-09-27|0x005c
//***************************************************************************             //04-09-24|0x005d
    file = fopen(error_name, "wt");                                                       //04-09-27|0x005e
    if(file != 0) fclose(file);                                                           //04-09-27|0x005f
//***************************************************************************             //04-09-27|0x0060
    test_read_position  = 0;                                                              //04-09-27|0x0061
    test_write_position = 0;                                                              //04-09-27|0x0062
//---------------------------------------------------------------------------             //04-09-27|0x0063
    file = fopen(test_name, "ab");                                                        //04-09-27|0x0064
    if(file != 0) fclose(file);                                                           //04-09-27|0x0065
//***************************************************************************             //04-09-27|0x0066
    file = fopen(report_name, "wt");                                                      //04-09-27|0x0067
    if(file != 0) fclose(file);                                                           //04-09-27|0x0068
//***************************************************************************             //04-09-27|0x0069
    return;                                                                               //04-09-24|0x006a
}                                                                                         //04-09-24|0x006b
//                                                                                        //05-24-97|0x006b
//***************************************************************************             //07-10-29|0x006e
//***************************************************************************             //07-10-29|0x006f
//******                                                               ******             //07-10-29|0x0070
//******                       executable_date                         ******             //07-10-29|0x0071
//******                                                               ******             //07-10-29|0x0072
//***************************************************************************             //07-10-29|0x0073
//***************************************************************************             //07-10-29|0x0074
//*******************************************************************************         //10-29-97|0x0075
//*******************************************************************************         //10-29-97|0x0075
// executable_date                                                                        //07-10-29|0x0075
//*******************************************************************************         //10-29-97|0x0075
//*******************************************************************************         //10-29-97|0x0075
ULONG PRECDIAG::executable_date(void) {                                                   //07-10-29|0x0075
//*******************************************************************************         //10-29-97|0x0075
//***************************************************************************             //07-10-29|0x0077
//***************************************************************************             //07-10-29|0x0078
  SCHAR executable_name[_MAX_PATH];                                                       //07-10-29|0x0079
  ULONG executable_time;                                                                  //07-10-29|0x007a
//***************************************************************************             //07-10-29|0x007b
//***************************************************************************             //07-10-29|0x007c
    StrCpy(executable_name, base_name);                                                   //07-10-29|0x007d
      {  struct stat  linux_write_time;                                                   //07-10-29|0x007e
         struct   tm  *local_time;                                                        //07-10-29|0x007e
         FILE *        file;                                                              //07-10-29|0x007e
         executable_time = 0;                                                             //07-10-29|0x007e
         file = fopen(executable_name, "r");                                              //07-10-29|0x007e
         if(file != 0)                                                                    //07-10-29|0x007e
           {                                                                              //07-10-29|0x007e
             stat(executable_name, &linux_write_time);                                    //07-10-29|0x007e
             local_time = localtime(&linux_write_time.st_mtime);                          //07-10-29|0x007e
             executable_time = local_time->tm_year;                                       //07-10-29|0x007e
             executable_time -= 80;                                                       //07-10-29|0x007e
             executable_time *= 16;                                                       //07-10-29|0x007e
             executable_time += local_time->tm_mon;                                       //07-10-29|0x007e
             executable_time *= 32;                                                       //07-10-29|0x007e
             executable_time += local_time->tm_mday;                                      //07-10-29|0x007e
             executable_time *= 32;                                                       //07-10-29|0x007e
             executable_time += local_time->tm_hour;                                      //07-10-29|0x007e
             executable_time *= 64;                                                       //07-10-29|0x007e
             executable_time += local_time->tm_min;                                       //07-10-29|0x007e
             executable_time *= 32;                                                       //07-10-29|0x007e
             executable_time += (local_time->tm_sec / 2);                                 //07-10-29|0x007e
             fclose(file);                                                                //07-10-29|0x007e
             }                                                                            //07-10-29|0x007e
         }                                                                                //07-10-29|0x007e
    return(executable_time);                                                              //07-10-29|0x007f
}                                                                                         //07-10-29|0x0080
//                                                                                        //05-24-97|0x0080
//***************************************************************************             //04-08-23|0x0083
//***************************************************************************             //04-08-23|0x0084
//******                                                               ******             //04-08-23|0x0085
//******                   pcg_system_error                            ******             //04-08-23|0x0086
//******                                                               ******             //04-08-23|0x0087
//***************************************************************************             //04-08-23|0x0088
//***************************************************************************             //04-08-23|0x0089
//*******************************************************************************         //10-29-97|0x008a
//*******************************************************************************         //10-29-97|0x008a
// pcg_system_error                                                                       //04-08-23|0x008a
//*******************************************************************************         //10-29-97|0x008a
//*******************************************************************************         //10-29-97|0x008a
void PRECDIAG::pcg_system_error(                                                          //04-08-23|0x008a
    SCHAR_FAR file_name,                                                                  //04-08-23|0x008a
    SWORD line_no                                                                         //04-08-23|0x008a
    ) {                                                                                   //04-08-23|0x008a
//*******************************************************************************         //10-29-97|0x008a
//***************************************************************************             //04-08-23|0x008c
//***************************************************************************             //04-08-23|0x008d
  FILE * error_file;                                                                      //04-08-23|0x008e
  SCHAR message[128];                                                                     //04-08-23|0x008f
//***************************************************************************             //04-08-23|0x0090
//***************************************************************************             //04-08-23|0x0091
    sprintf(message, "PCG ERROR: %s -- %d", file_name, line_no);                          //04-08-23|0x0092
    printf("%s\n", message);                                                              //04-08-23|0x0093
//***************************************************************************             //04-08-23|0x0094
    if((error_file = fopen(error_name, "at")) == 0)                   return;             //04-09-27|0x0095
    if(fprintf(error_file, "%s\n", message)  == 0)                   return;              //04-08-23|0x0096
    fclose(error_file);                                                                   //04-08-23|0x0097
    return;                                                                               //04-08-23|0x0098
}                                                                                         //04-08-23|0x0099
//                                                                                        //05-24-97|0x0099
//***************************************************************************             //04-10-05|0x009c
//***************************************************************************             //04-10-05|0x009d
//******                                                               ******             //04-10-05|0x009e
//******                   basic_test_reset                            ******             //04-10-05|0x009f
//******                                                               ******             //04-10-05|0x00a0
//***************************************************************************             //04-10-05|0x00a1
//***************************************************************************             //04-10-05|0x00a2
//*******************************************************************************         //10-29-97|0x00a3
//*******************************************************************************         //10-29-97|0x00a3
// basic_test_reset                                                                       //04-10-05|0x00a3
//*******************************************************************************         //10-29-97|0x00a3
//*******************************************************************************         //10-29-97|0x00a3
UINT PRECDIAG::basic_test_reset(void) {                                                   //04-10-05|0x00a3
//*******************************************************************************         //10-29-97|0x00a3
//***************************************************************************             //04-10-05|0x00a5
//***************************************************************************             //04-10-05|0x00a6
  FILE * file;                                                                            //04-10-05|0x00a7
//***************************************************************************             //04-10-05|0x00a8
    file = fopen(test_name, "wb");                                                        //04-10-05|0x00a9
    if(file == 0)                                          ReturnSystemError;             //04-10-05|0x00aa
//***************************************************************************             //04-10-05|0x00ab
    if(fclose(file))                                       ReturnSystemError;             //04-10-05|0x00ac
    return(Success);                                                                      //04-10-05|0x00ad
}                                                                                         //04-10-05|0x00ae
//                                                                                        //05-24-97|0x00ae
//***************************************************************************             //04-09-27|0x00b1
//***************************************************************************             //04-09-27|0x00b2
//******                                                               ******             //04-09-27|0x00b3
//******                   basic_test_read                             ******             //04-09-27|0x00b4
//******                                                               ******             //04-09-27|0x00b5
//***************************************************************************             //04-09-27|0x00b6
//***************************************************************************             //04-09-27|0x00b7
//*******************************************************************************         //10-29-97|0x00b8
//*******************************************************************************         //10-29-97|0x00b8
// basic_test_read                                                                        //04-09-27|0x00b8
//*******************************************************************************         //10-29-97|0x00b8
//*******************************************************************************         //10-29-97|0x00b8
UINT PRECDIAG::basic_test_read(                                                           //04-09-27|0x00b8
    UINT_FAR record_far,                                                                  //04-09-27|0x00b8
    UINT record_length                                                                    //04-09-27|0x00b8
    ) {                                                                                   //04-09-27|0x00b8
//*******************************************************************************         //10-29-97|0x00b8
//***************************************************************************             //04-09-27|0x00ba
//***************************************************************************             //04-09-27|0x00bb
  FILE * file;                                                                            //04-09-27|0x00bc
  ULONG file_length;                                                                      //04-09-27|0x00bd
  SLONG test_length;                                                                      //04-09-27|0x00be
  SLONG test_position;                                                                    //04-09-27|0x00bf
//***************************************************************************             //04-09-27|0x00c0
    file = fopen(test_name, "rb");                                                        //04-09-27|0x00c1
    if(file == 0)                                          ReturnSystemError;             //04-09-27|0x00c2
//***************************************************************************             //04-09-27|0x00c3
    if(fseek(file, 0L, SEEK_END))                          ReturnSystemError;             //04-09-27|0x00c4
    if((file_length = ftell(file)) == -1L)                 ReturnSystemError;             //04-09-27|0x00c5
//***************************************************************************             //04-09-27|0x00c6
    if(file_length > 0)                                                                   //04-09-27|0x00c7
      {                                                                                   //04-09-27|0x00c8
        if(fseek(file, test_read_position, SEEK_SET))      ReturnSystemError;             //04-09-27|0x00c9
//---------------------------------------------------------------------------             //04-09-27|0x00ca
        test_length = fread(&test_position, 2, 2, file);                                  //04-09-27|0x00cb
        if(test_length != 2)                               ReturnSystemError;             //04-09-27|0x00cc
        if(test_read_position != test_position)            ReturnSystemError;             //04-09-27|0x00cd
//---------------------------------------------------------------------------             //04-09-27|0x00ce
        test_length = fread(record_far, 2, record_length, file);                          //04-09-27|0x00cf
        if(test_length != record_length)                   ReturnSystemError;             //04-09-27|0x00d0
        if(*record_far != record_length)                   ReturnSystemError;             //04-09-27|0x00d1
//---------------------------------------------------------------------------             //04-09-27|0x00d2
        if(fseek(file, 0L, SEEK_CUR))                      ReturnSystemError;             //04-09-27|0x00d3
        if((test_read_position = ftell(file)) == -1L)      ReturnSystemError;             //04-09-27|0x00d4
        }                                                                                 //04-09-27|0x00d5
//***************************************************************************             //04-09-27|0x00d6
    if(fclose(file))                                       ReturnSystemError;             //04-09-27|0x00d7
    return(Success);                                                                      //04-09-27|0x00d8
}                                                                                         //04-09-27|0x00d9
//                                                                                        //05-24-97|0x00d9
//***************************************************************************             //04-09-27|0x00dc
//***************************************************************************             //04-09-27|0x00dd
//******                                                               ******             //04-09-27|0x00de
//******                   basic_test_write                            ******             //04-09-27|0x00df
//******                                                               ******             //04-09-27|0x00e0
//***************************************************************************             //04-09-27|0x00e1
//***************************************************************************             //04-09-27|0x00e2
//*******************************************************************************         //10-29-97|0x00e3
//*******************************************************************************         //10-29-97|0x00e3
// basic_test_write                                                                       //04-09-27|0x00e3
//*******************************************************************************         //10-29-97|0x00e3
//*******************************************************************************         //10-29-97|0x00e3
UINT PRECDIAG::basic_test_write(                                                          //04-09-27|0x00e3
    UINT_FAR record_far                                                                   //04-09-27|0x00e3
    ) {                                                                                   //04-09-27|0x00e3
//*******************************************************************************         //10-29-97|0x00e3
//***************************************************************************             //04-09-27|0x00e5
//***************************************************************************             //04-09-27|0x00e6
  FILE * file;                                                                            //04-09-27|0x00e7
  ULONG test_length;                                                                      //04-09-27|0x00e8
//***************************************************************************             //04-09-27|0x00e9
    file = fopen(test_name, "r+b");                                                       //04-09-27|0x00ea
    if(file == 0)                                          ReturnSystemError;             //04-09-27|0x00eb
//***************************************************************************             //04-09-27|0x00ec
    if(fseek(file, test_write_position, SEEK_SET))         ReturnSystemError;             //04-09-27|0x00ed
//***************************************************************************             //04-09-27|0x00ee
    test_length = fwrite(&test_write_position, 2, 2, file);                               //04-09-27|0x00ef
    if(test_length != 2)                                   ReturnSystemError;             //04-09-27|0x00f0
//***************************************************************************             //04-09-27|0x00f1
    test_length = fwrite(record_far, 2, *record_far, file);                               //04-09-27|0x00f2
    if(test_length != *record_far)                         ReturnSystemError;             //04-09-27|0x00f3
//***************************************************************************             //04-09-27|0x00f4
    if(fseek(file, 0L, SEEK_CUR))                          ReturnSystemError;             //04-09-27|0x00f5
    if((test_write_position = ftell(file)) == -1L)         ReturnSystemError;             //04-09-27|0x00f6
//***************************************************************************             //04-09-27|0x00f7
    if(fclose(file))                                       ReturnSystemError;             //04-09-27|0x00f8
    return(Success);                                                                      //04-09-27|0x00f9
}                                                                                         //04-09-27|0x00fa
//                                                                                        //05-24-97|0x00fa
//***************************************************************************             //04-09-27|0x00fd
//***************************************************************************             //04-09-27|0x00fe
//******                                                               ******             //04-09-27|0x00ff
//******                   basic_test_report                           ******             //04-09-27|0x0100
//******                                                               ******             //04-09-27|0x0101
//***************************************************************************             //04-09-27|0x0102
//***************************************************************************             //04-09-27|0x0103
//*******************************************************************************         //10-29-97|0x0104
//*******************************************************************************         //10-29-97|0x0104
// basic_test_report                                                                      //04-09-27|0x0104
//*******************************************************************************         //10-29-97|0x0104
//*******************************************************************************         //10-29-97|0x0104
UINT PRECDIAG::basic_test_report(                                                         //04-09-27|0x0104
    UINT_FAR record_far,                                                                  //04-09-27|0x0104
    SCHAR_FAR name                                                                        //04-09-27|0x0104
    ) {                                                                                   //04-09-27|0x0104
//*******************************************************************************         //10-29-97|0x0104
//***************************************************************************             //04-09-27|0x0106
//***************************************************************************             //04-09-27|0x0107
  UWORD index;                                                                            //04-09-27|0x0108
  FILE * file;                                                                            //04-09-27|0x0109
  UINT_FAR addr;                                                                          //04-09-27|0x010a
//***************************************************************************             //04-09-27|0x010b
    file = fopen(report_name, "at");                                                      //04-09-27|0x010c
    if(file == 0)                                          ReturnSystemError;             //04-09-27|0x010d
//***************************************************************************             //04-09-27|0x010e
    if(fprintf(file, "Routine Name: %s\n", name) == 0)    ReturnSystemError;              //04-09-27|0x010f
//***************************************************************************             //04-09-27|0x0110
    for(index=1;  index<*record_far; ++index)                                             //04-09-27|0x0111
      {                                                                                   //04-09-27|0x0112
        addr = record_far + index;                                                        //04-09-27|0x0113
        switch((index & 0x0007))                                                          //04-09-27|0x0114
          {                                                                               //04-09-27|0x0115
//---------------------------------------------------------------------------             //04-09-27|0x0116
            case 0x0001:                                                                  //04-09-27|0x0117
              if(fprintf(file, "      %8d", *addr) == 0)   ReturnSystemError;             //04-09-27|0x0118
              break;                                                                      //04-09-27|0x0119
//---------------------------------------------------------------------------             //04-10-05|0x011a
            case 0x0000:                                                                  //04-10-05|0x011b
              if(fprintf(file,    "%8d\n", *addr) == 0)   ReturnSystemError;              //04-10-05|0x011c
              break;                                                                      //04-10-05|0x011d
//---------------------------------------------------------------------------             //04-09-27|0x011e
            default:                                                                      //04-09-27|0x011f
              if(fprintf(file,      "%8d", *addr)  == 0)   ReturnSystemError;             //04-09-27|0x0120
              break;                                                                      //04-09-27|0x0121
            }                                                                             //04-09-27|0x0122
        }                                                                                 //04-09-27|0x0123
//***************************************************************************             //04-09-27|0x0124
    switch((index & 0x0007))                                                              //04-09-27|0x0125
      {                                                                                   //04-09-27|0x0126
//---------------------------------------------------------------------------             //06-08-23|0x0127
        case 0x0001:                                                                      //06-08-23|0x0128
          break;                                                                          //06-08-23|0x0129
//---------------------------------------------------------------------------             //04-09-27|0x012a
        default:                                                                          //04-09-27|0x012b
          if(fprintf(file,          "\n", *addr)  == 0)   ReturnSystemError;              //04-09-27|0x012c
          break;                                                                          //04-09-27|0x012d
                                                                                          //04-09-27|0x012e
        }                                                                                 //04-09-27|0x012f
//***************************************************************************             //04-09-27|0x0130
    if(fclose(file))                                       ReturnSystemError;             //04-09-27|0x0131
    return(Success);                                                                      //04-09-27|0x0132
}                                                                                         //04-09-27|0x0133
//                                                                                        //05-24-97|0x0133
//***************************************************************************             //04-08-23|0x0136
//***************************************************************************             //04-08-23|0x0137
//******                                                               ******             //04-08-23|0x0138
//******                          finish                               ******             //04-08-23|0x0139
//******                                                               ******             //04-08-23|0x013a
//***************************************************************************             //04-08-23|0x013b
//***************************************************************************             //04-08-23|0x013c
//*******************************************************************************         //10-29-97|0x013d
//*******************************************************************************         //10-29-97|0x013d
// finish                                                                                 //07-10-29|0x013d
//*******************************************************************************         //10-29-97|0x013d
//*******************************************************************************         //10-29-97|0x013d
UINT PRECDIAG::finish(                                                                    //07-10-29|0x013d
    SCHAR_FAR Message                                                                     //07-10-29|0x013d
    ) {                                                                                   //07-10-29|0x013d
//*******************************************************************************         //10-29-97|0x013d
//***************************************************************************             //04-08-23|0x013f
//***************************************************************************             //04-08-23|0x0140
    SCHAR  message[85];                                                              //07-10-29|0x0141
//***************************************************************************             //04-08-23|0x0142
//***************************************************************************             //04-08-23|0x0143
    MemSet(message,           0x00, 85);                                                  //07-10-29|0x0144
    MemCCpy(message, Message, 0x00, 78);                                                  //07-10-29|0x0145
//***************************************************************************             //04-08-23|0x0146
    switch(GuiTestEmpty())                                                                //07-03-23|0x0147
      {                                                                                   //07-03-23|0x0148
        case Yes: if(GuiWriteLine(message)  == Success)                break;             //07-03-23|0x0149
                  ReturnSystemError;                                                      //07-03-23|0x014a
        case No:  if(GuiAppendLine(message) == Success)                break;             //07-10-29|0x014b
                  ReturnSystemError;                                                      //07-10-29|0x014c
        default:  ReturnSystemError;                                                      //07-03-23|0x014d
        }                                                                                 //07-03-23|0x014e
    return(UserError);                                                                    //05-08-97|0x014f
}                                                                                         //05-08-97|0x0150
//                                                                                        //05-24-97|0x0150
//***************************************************************************             //08-02-11|0x0153
//***************************************************************************             //08-02-11|0x0154
//******                                                               ******             //08-02-11|0x0155
//******                       intervention_menu                       ******             //08-02-11|0x0156
//******                                                               ******             //08-02-11|0x0157
//***************************************************************************             //08-02-11|0x0158
//***************************************************************************             //08-02-11|0x0159
//*******************************************************************************         //10-29-97|0x015c
//*******************************************************************************         //10-29-97|0x015c
// intervention_menu                                                                      //08-02-11|0x015c
//*******************************************************************************         //10-29-97|0x015c
//*******************************************************************************         //10-29-97|0x015c
UINT PRECDIAG::intervention_menu(void) {                                                  //08-02-11|0x015c
//*******************************************************************************         //10-29-97|0x015c
//***************************************************************************             //08-02-11|0x0160
//***************************************************************************             //08-02-11|0x0161
  SCHAR keystroke[17];                                                                    //08-02-11|0x0162
//***************************************************************************             //08-02-11|0x0163
loop:                                                                                     //08-02-11|0x0164
    printf("\nIntervention Required\n");                                                  //08-02-11|0x0165
    puts("X-Stop, T-Try Again:  Depress Key Followed by Enter");                          //08-02-11|0x0166
    MemSet(&keystroke[0], 0, 16);                                                         //08-02-11|0x0167
    fgets(&keystroke[0], 16, stdin);                                                      //08-02-11|0x0168
    switch(keystroke[0])                                                                  //08-02-11|0x0169
      {                                                                                   //08-02-11|0x016a
        case 'T':                                                 break;                  //08-02-11|0x016b
        case 'X':                                       ReturnSystemError;                //08-02-11|0x016c
        default:                                                  goto loop;              //08-02-11|0x016d
        }                                                                                 //08-02-11|0x016e
    printf("\n");                                                                         //08-02-11|0x016f
//***************************************************************************             //08-02-11|0x0170
    return(Success);                                                                      //08-02-11|0x0171
}                                                                                         //08-02-11|0x0172
//                                                                                        //05-24-97|0x0172
//***************************************************************************             //07-02-19|0x0175
//***************************************************************************             //07-02-19|0x0176
//******                                                               ******             //07-02-19|0x0177
//******                       checkout_pause                          ******             //07-02-19|0x0178
//******                                                               ******             //07-02-19|0x0179
//***************************************************************************             //07-02-19|0x017a
//***************************************************************************             //07-02-19|0x017b
//*******************************************************************************         //10-29-97|0x017f
//*******************************************************************************         //10-29-97|0x017f
// checkout_menu                                                                          //07-02-19|0x017f
//*******************************************************************************         //10-29-97|0x017f
//*******************************************************************************         //10-29-97|0x017f
UINT PRECDIAG::checkout_menu(                                                             //07-02-19|0x017f
    SCHAR_FAR Name                                                                        //07-02-19|0x017f
    ) {                                                                                   //07-02-19|0x017f
//*******************************************************************************         //10-29-97|0x017f
//***************************************************************************             //07-02-19|0x0183
//***************************************************************************             //07-02-19|0x0184
  SCHAR keystroke[17];                                                                    //07-02-19|0x0185
//***************************************************************************             //07-02-19|0x0186
loop:                                                                                     //07-02-19|0x0187
    printf("\nDebug Required: %s\n", Name);                                               //07-02-19|0x0188
    puts("X-Stop, C-Continue:  Depress Key Followed by Enter");                           //07-02-19|0x0189
    MemSet(&keystroke[0], 0, 16);                                                         //07-02-19|0x018a
    fgets(&keystroke[0], 16, stdin);                                                      //07-02-19|0x018b
    switch(keystroke[0])                                                                  //07-02-19|0x018c
      {                                                                                   //07-02-19|0x018d
        case 'C':                                                 break;                  //07-02-19|0x018e
        case 'X':                                       ReturnSystemError;                //07-02-19|0x018f
        default:                        goto loop;                                        //07-02-19|0x0190
        }                                                                                 //07-02-19|0x0191
    printf("\n");                                                                         //07-02-19|0x0192
//***************************************************************************             //07-02-19|0x0193
    return(Success);                                                                      //07-02-19|0x0194
}                                                                                         //07-02-19|0x0195
//                                                                                        //05-24-97|0x0195
//***************************************************************************             //check   |0x0198
//***************************************************************************             //check   |0x0199
//******                                                               ******             //check   |0x019a
//******                       trunc_sint_int                          ******             //check   |0x019b
//******                                                               ******             //check   |0x019c
//***************************************************************************             //check   |0x019d
//***************************************************************************             //check   |0x019e
//*******************************************************************************         //10-29-97|0x01a2
//*******************************************************************************         //10-29-97|0x01a2
// trunc_sint_int                                                                         //check   |0x01a2
//*******************************************************************************         //10-29-97|0x01a2
//*******************************************************************************         //10-29-97|0x01a2
UINT PRECDIAG::trunc_sint_int(                                                            //check   |0x01a2
    SINT_FAR OutFar,                                                                      //check   |0x01a2
    SWORD In                                                                              //check   |0x01a2
    ) {                                                                                   //check   |0x01a2
//*******************************************************************************         //10-29-97|0x01a2
//***************************************************************************             //check   |0x01a6
//***************************************************************************             //check   |0x01a7
  WORDS work;                                                                             //check   |0x01a8
//***************************************************************************             //check   |0x01a9
    work.sword     = In;                                                                  //check   |0x01aa
    work.ulong    += 0x80000000;                                                          //check   |0x01ab
    if(work.ulong <= 0x8000)                               ReturnSystemError;             //check   |0x01ac
    if(work.ulong >= 0x80008000)                           ReturnSystemError;             //check   |0x01ad
    work.ulong    -= 0x80000000;                                                          //check   |0x01ae
    *OutFar        = work.sint0;                                                          //check   |0x01af
//***************************************************************************             //check   |0x01b0
    return(Success);                                                                      //check   |0x01b1
}                                                                                         //check   |0x01b2
//                                                                                        //05-24-97|0x01b2
//***************************************************************************             //check   |0x01b5
//***************************************************************************             //check   |0x01b6
//******                                                               ******             //check   |0x01b7
//******                       trunc_string_size                       ******             //check   |0x01b8
//******                                                               ******             //check   |0x01b9
//***************************************************************************             //check   |0x01ba
//***************************************************************************             //check   |0x01bb
//*******************************************************************************         //10-29-97|0x01bf
//*******************************************************************************         //10-29-97|0x01bf
// trunc_string_size                                                                      //check   |0x01bf
//*******************************************************************************         //10-29-97|0x01bf
//*******************************************************************************         //10-29-97|0x01bf
UINT PRECDIAG::trunc_string_size(                                                         //check   |0x01bf
    SINT_FAR SizeFar,                                                                     //check   |0x01bf
    SCHAR_FAR InFar                                                                       //check   |0x01bf
    ) {                                                                                   //check   |0x01bf
//*******************************************************************************         //10-29-97|0x01bf
//***************************************************************************             //check   |0x01c3
//***************************************************************************             //check   |0x01c4
  SWORD work;                                                                             //check   |0x01c5
//***************************************************************************             //check   |0x01c6
//***************************************************************************             //check   |0x01c7
    work    =   StrLen(InFar);                                                            //check   |0x01c8
    if(TruncSintInt(SizeFar, work) != Success)             ReturnSystemError;             //check   |0x01c9
    return(Success);                                                                      //check   |0x01ca
}                                                                                         //check   |0x01cb
//                                                                                        //05-24-97|0x01cb
//*******************************************************************************         //05-24-97|0x01cf
//*******************************************************************************         //05-24-97|0x01cf
//****                       END OF FILE                                     ****         //05-24-97|0x01cf
//*******************************************************************************         //05-24-97|0x01cf
//*******************************************************************************         //05-24-97|0x01cf
