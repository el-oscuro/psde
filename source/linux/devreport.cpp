//*****************************************************************************           //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//                                                                                        //11-02-14|0x000b
// VERSION REPORT GENERATOR                                                               //11-02-14|0x000b
//                                                                                        //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//  Copyright: 2006 Robert H. Adams                                                       //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//  The purpose of this program as well as instructions regarding its use is              //11-02-14|0x000b
//  defined in the associated manual.                                                     //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//  This program is free software; you can redistribute it and/or modify                  //11-02-14|0x000b
//  it under the terms of the GNU General Public License as published by                  //11-02-14|0x000b
//  the Free Software Foundation; either version 2 of the License, or                     //11-02-14|0x000b
//  (at your option) any later version.                                                   //11-02-14|0x000b
//                                                                                        //11-02-14|0x000b
//  This program is distributed in the hope that it will be useful,                       //11-02-14|0x000b
//  but WITHOUT ANY WARRANTY; without even the implied warranty of                        //11-02-14|0x000b
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                         //11-02-14|0x000b
//  GNU General Public License for more details.                                          //11-02-14|0x000b
//                                                                                        //11-02-14|0x000b
//  You should have received a copy of the GNU General Public License                     //11-02-14|0x000b
//  along with this program; if not, write to the Free Software                           //11-02-14|0x000b
//  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA., 02110-1301            //11-02-14|0x000b
//  USA                                                                                   //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//  For further information, please contact Robert Adams:                                 //11-02-14|0x000b
//     EMail:    robert.adams@whatifwe.com                                                //11-02-14|0x000b
//     Mail:     PO Box 156, Sun Valley, Ca. 91353-0155, USA                              //11-02-14|0x000b
//  Or visit the website, "www.whatifwe.com".                                             //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
//*****************************************************************************           //11-02-14|0x000b
#ifdef WIN31_SYSTEM                                                                       //05-24-97|0x000c
#include "precwn31.h"                                                                     //05-24-97|0x000c
#endif                                                                                    //05-24-97|0x000c
#ifdef WIN95_SYSTEM                                                                       //05-24-97|0x000c
#include "precwn95.h"                                                                     //05-24-97|0x000c
#endif                                                                                    //05-24-97|0x000c
#ifdef MSDOS_SYSTEM                                                                       //05-24-97|0x000c
#include "precdos.h"                                                                      //05-24-97|0x000c
#endif                                                                                    //05-24-97|0x000c
#include "prechost.h"                                                                     //05-24-97|0x000c
#include "devreport.h"                                                                    //11-02-14|0x000c
#include "devreport.hxx"                                                                  //11-02-14|0x000c
#include "devreport.hpp"                                                                  //11-02-14|0x000c
#include "precdiag.h"                                                                     //11-02-14|0x000d
#include "precfile.h"                                                                     //11-02-14|0x000e
#define StrLen(i) strlen(i)                                                               //11-02-14|0x0016
#define StrCat(i,j) strcat(i,j)                                                           //11-02-14|0x0016
#define StrCpy(i,j) strcpy(i,j)                                                           //11-02-14|0x0016
#define StrCmp(i,j) Str_Comp((SCHAR_FAR)i,j,256)                                          //11-02-14|0x0016
#define StrRChr(i,j) strrchr(i,j)                                                         //11-02-14|0x0016
#define StrChr(i,j) strchr(i,j)                                                           //11-02-14|0x0016
#define StrToByteInt(i,j) GetInteger(i,&j,0xff)                                           //11-02-14|0x0016
#define StrToInt(i,j) GetInteger(i,&j,0xffff)                                             //11-02-14|0x0016
#define StrToLongInt(i,j) GetInteger(i,&j,0xffffffffL)                                    //11-02-14|0x0016
#define StrToByteHex(i,j) GetHex(i,&j,1)                                                  //11-02-14|0x0016
#define StrToHex(i,j) GetHex(i,&j,2)                                                      //11-02-14|0x0016
#define StrToLongHex(i,j) GetHex(i,&j,4)                                                  //11-02-14|0x0016
#define FindName(i) strrchr(i, '/')                                                       //11-02-14|0x0016
#define Allocate(k) (k##_FAR) calloc(1,sizeof(k))                                         //11-02-14|0x0017
#define Free(k) free(k)                                                                   //11-02-14|0x0017
#define MemSet(i,j,k) memset(i,j,k)                                                       //11-02-14|0x0017
#define MemCCpy(i,j,k,l) Mem_C_Copy((UCHAR_FAR) i, (UCHAR_FAR) j,k,l)                     //11-02-14|0x0017
#define MemCpy(i,j,k) memcpy(i,j,k)                                                       //11-02-14|0x0017
#define LineEnd 0x0d                                                                      //11-02-14|0x0017
VERSION_REPORT version_report;                                                            //11-02-14|0x0036
static UINT test_samples[TestIndex];                                                      //11-02-14|0x0046
//***************************************************************************             //11-02-14|0x004d
//***************************************************************************             //11-02-14|0x004e
//******                                                               ******             //11-02-14|0x004f
//******               report_open(Name, Type)                         ******             //11-02-14|0x0050
//******                                                               ******             //11-02-14|0x0051
//***************************************************************************             //11-02-14|0x0052
//***************************************************************************             //11-02-14|0x0053
//*******************************************************************************         //10-29-97|0x0058
//*******************************************************************************         //10-29-97|0x0058
// report_open                                                                            //11-02-14|0x0058
//*******************************************************************************         //10-29-97|0x0058
//*******************************************************************************         //10-29-97|0x0058
UINT VERSION_REPORT::report_open(                                                         //11-02-14|0x0058
    SCHAR_FAR Name,                                                                       //11-02-14|0x0058
    SCHAR_FAR Type                                                                        //11-02-14|0x0058
    ) {                                                                                   //11-02-14|0x0058
//*******************************************************************************         //10-29-97|0x0058
//***************************************************************************             //11-02-14|0x005c
//***************************************************************************             //11-02-14|0x005d
    SCHAR       extent[256];                                                              //11-02-14|0x005e
    ULONG       date;                                                                     //11-02-14|0x0060
    ULONG       day;                                                                      //11-02-14|0x0061
    ULONG       month;                                                                    //11-02-14|0x0062
    ULONG       year;                                                                     //11-02-14|0x0063
//***************************************************************************             //11-02-14|0x0064
//******                                                               ******             //11-02-14|0x0065
//****** Get the date                                                  ******             //11-02-14|0x0066
//******                                                               ******             //11-02-14|0x0067
//***************************************************************************             //11-02-14|0x0068
      {  time_t   long_time;                                                              //11-02-14|0x0069
         struct tm *local_time;                                                           //11-02-14|0x0069
         time(&long_time);                                                                //11-02-14|0x0069
         local_time = localtime(&long_time);                                              //11-02-14|0x0069
         date =  local_time->tm_year;                                                     //11-02-14|0x0069
         date -= 80;                                                                      //11-02-14|0x0069
         date *= 16;                                                                      //11-02-14|0x0069
         date += local_time->tm_mon;                                                      //11-02-14|0x0069
         date *= 32;                                                                      //11-02-14|0x0069
         date += local_time->tm_mday;                                                     //11-02-14|0x0069
         date *= 32;                                                                      //11-02-14|0x0069
         date += local_time->tm_hour;                                                     //11-02-14|0x0069
         date *= 64;                                                                      //11-02-14|0x0069
         date += local_time->tm_min;                                                      //11-02-14|0x0069
         date *= 32;                                                                      //11-02-14|0x0069
         date += (local_time->tm_sec / 2);                                                //11-02-14|0x0069
         }                                                                                //11-02-14|0x0069
//---------------------------------------------------------------------------             //11-02-14|0x006a
    date    /=  32;                                                                       //11-02-14|0x006b
    date    /=  64;                                                                       //11-02-14|0x006c
    date    /=  32;                                                                       //11-02-14|0x006d
//---------------------------------------------------------------------------             //11-02-14|0x006e
    day      =  date % 32;                                                                //11-02-14|0x006f
    date    /=  32;                                                                       //11-02-14|0x0070
//---------------------------------------------------------------------------             //11-02-14|0x0071
    month    =  (date % 16) + 1;                                                          //11-02-14|0x0072
    date    /=  16;                                                                       //11-02-14|0x0073
//---------------------------------------------------------------------------             //11-02-14|0x0074
    year     =  date + 1980;                                                              //11-02-14|0x0075
//***************************************************************************             //11-02-14|0x0076
//******                                                               ******             //11-02-14|0x0077
//****** Load the name                                                 ******             //11-02-14|0x0078
//******                                                               ******             //11-02-14|0x0079
//***************************************************************************             //11-02-14|0x007a
    sprintf(extent, "_%s_%04d_%02d_%02d", Type, year, month, day);                        //11-02-14|0x007b
    StrCat(extent,  RPT_EXTENT);                                                          //11-02-14|0x007c
//***************************************************************************             //11-02-14|0x007d
    switch(FileInitialText(&report_file))                        _SwitchGroup             //11-02-14|0x007e
    switch(FileEnterName(Name, &extent[0]))                      _SwitchGroup             //11-02-14|0x007f
    switch(FileRelease())                                        _SwitchGroup             //11-02-14|0x0080
//***************************************************************************             //11-02-14|0x0081
    return_test(report_open_1);                                                           //11-02-14|0x0082
}                                                                                         //11-02-14|0x0083
//                                                                                        //05-24-97|0x0083
//***************************************************************************             //11-02-15|0x0086
//***************************************************************************             //11-02-15|0x0087
//******                                                               ******             //11-02-15|0x0088
//******               report_write(Addr)                              ******             //11-02-15|0x0089
//******                                                               ******             //11-02-15|0x008a
//***************************************************************************             //11-02-15|0x008b
//***************************************************************************             //11-02-15|0x008c
//*******************************************************************************         //10-29-97|0x0091
//*******************************************************************************         //10-29-97|0x0091
// report_write                                                                           //11-02-15|0x0091
//*******************************************************************************         //10-29-97|0x0091
//*******************************************************************************         //10-29-97|0x0091
UINT VERSION_REPORT::report_write(                                                        //11-02-15|0x0091
    STRING_DATA_FAR Addr                                                                  //11-02-15|0x0091
    ) {                                                                                   //11-02-15|0x0091
//*******************************************************************************         //10-29-97|0x0091
//***************************************************************************             //11-02-15|0x0095
//***************************************************************************             //11-02-15|0x0096
    switch(FileCommitText(&report_file))                         _SwitchGroup             //11-02-15|0x0097
    switch(FilePutText(Addr))                                                             //11-02-15|0x0098
      {                                                                                   //11-02-21|0x0099
        case Success:                                                break;               //11-02-21|0x009a
        case UserError:                                                                   //11-02-21|0x009b
          switch(FileRelease())                                  _SwitchGroup             //11-02-21|0x009c
          return(UserError);                                                              //11-02-21|0x009d
        default:                                           ReturnSystemError;             //11-02-21|0x009e
        }                                                                                 //11-02-21|0x009f
//***************************************************************************             //11-02-21|0x00a0
    switch(FilePutCRLF())                                                                 //11-02-21|0x00a1
      {                                                                                   //11-02-21|0x00a2
        case Success:                                                break;               //11-02-21|0x00a3
        case UserError:                                                                   //11-02-21|0x00a4
          switch(FileRelease())                                  _SwitchGroup             //11-02-21|0x00a5
          return(UserError);                                                              //11-02-21|0x00a6
        default:                                           ReturnSystemError;             //11-02-21|0x00a7
        }                                                                                 //11-02-21|0x00a8
//***************************************************************************             //11-02-21|0x00a9
    switch(FileRelease())                                        _SwitchGroup             //11-02-15|0x00aa
//***************************************************************************             //11-02-15|0x00ab
    return_test(report_write_1);                                                          //11-02-15|0x00ac
}                                                                                         //11-02-15|0x00ad
//                                                                                        //05-24-97|0x00ad
//***************************************************************************             //11-02-15|0x00b0
//***************************************************************************             //11-02-15|0x00b1
//******                                                               ******             //11-02-15|0x00b2
//******               report_crlf()                                   ******             //11-02-15|0x00b3
//******                                                               ******             //11-02-15|0x00b4
//***************************************************************************             //11-02-15|0x00b5
//***************************************************************************             //11-02-15|0x00b6
//*******************************************************************************         //10-29-97|0x00ba
//*******************************************************************************         //10-29-97|0x00ba
// report_crlf                                                                            //11-02-15|0x00ba
//*******************************************************************************         //10-29-97|0x00ba
//*******************************************************************************         //10-29-97|0x00ba
UINT VERSION_REPORT::report_crlf(void) {                                                  //11-02-15|0x00ba
//*******************************************************************************         //10-29-97|0x00ba
//***************************************************************************             //11-02-15|0x00be
//***************************************************************************             //11-02-15|0x00bf
    switch(FileCommitText(&report_file))                         _SwitchGroup             //11-02-15|0x00c0
    switch(FilePutCRLF())                                                                 //11-02-21|0x00c1
      {                                                                                   //11-02-21|0x00c2
        case Success:                                                break;               //11-02-21|0x00c3
        case UserError:                                                                   //11-02-21|0x00c4
          switch(FileRelease())                                  _SwitchGroup             //11-02-21|0x00c5
          return(UserError);                                                              //11-02-21|0x00c6
        default:                                           ReturnSystemError;             //11-02-21|0x00c7
        }                                                                                 //11-02-21|0x00c8
    switch(FileRelease())                                        _SwitchGroup             //11-02-15|0x00c9
//***************************************************************************             //11-02-15|0x00ca
    return_test(report_write_1);                                                          //11-02-15|0x00cb
}                                                                                         //11-02-15|0x00cc
//                                                                                        //05-24-97|0x00cc
//***************************************************************************             //11-02-17|0x00cf
//***************************************************************************             //11-02-17|0x00d0
//******                                                               ******             //11-02-17|0x00d1
//******               report_close()                                  ******             //11-02-17|0x00d2
//******                                                               ******             //11-02-17|0x00d3
//***************************************************************************             //11-02-17|0x00d4
//***************************************************************************             //11-02-17|0x00d5
//*******************************************************************************         //10-29-97|0x00d9
//*******************************************************************************         //10-29-97|0x00d9
// report_close                                                                           //11-02-17|0x00d9
//*******************************************************************************         //10-29-97|0x00d9
//*******************************************************************************         //10-29-97|0x00d9
UINT VERSION_REPORT::report_close(void) {                                                 //11-02-17|0x00d9
//*******************************************************************************         //10-29-97|0x00d9
//***************************************************************************             //11-02-17|0x00dd
//***************************************************************************             //11-02-17|0x00de
    switch(FileCommitText(&report_file))                         _SwitchGroup             //11-02-17|0x00df
    switch(FileClose())                                          _SwitchGroup             //11-02-17|0x00e0
    switch(FileRelease())                                        _SwitchGroup             //11-02-17|0x00e1
//***************************************************************************             //11-02-17|0x00e2
    return_test(report_write_1);                                                          //11-02-17|0x00e3
}                                                                                         //11-02-17|0x00e4
//                                                                                        //05-24-97|0x00e4
//***************************************************************************             //11-02-18|0x00e7
//***************************************************************************             //11-02-18|0x00e8
//******                                                               ******             //11-02-18|0x00e9
//******               report_delete()                                 ******             //11-02-18|0x00ea
//******                                                               ******             //11-02-18|0x00eb
//***************************************************************************             //11-02-18|0x00ec
//***************************************************************************             //11-02-18|0x00ed
//*******************************************************************************         //10-29-97|0x00f1
//*******************************************************************************         //10-29-97|0x00f1
// report_delete                                                                          //11-02-18|0x00f1
//*******************************************************************************         //10-29-97|0x00f1
//*******************************************************************************         //10-29-97|0x00f1
UINT VERSION_REPORT::report_delete(void) {                                                //11-02-18|0x00f1
//*******************************************************************************         //10-29-97|0x00f1
//***************************************************************************             //11-02-18|0x00f5
//***************************************************************************             //11-02-18|0x00f6
    switch(FileCommitText(&report_file))                         _SwitchGroup             //11-02-18|0x00f7
    switch(FileDelete())                                         _SwitchGroup             //11-02-18|0x00f8
    switch(FileRelease())                                        _SwitchGroup             //11-02-18|0x00f9
//***************************************************************************             //11-02-18|0x00fa
    return_test(report_write_1);                                                          //11-02-18|0x00fb
}                                                                                         //11-02-18|0x00fc
//                                                                                        //05-24-97|0x00fc
//***************************************************************************             //11-02-18|0x00ff
//***************************************************************************             //11-02-18|0x0100
//******                                                               ******             //11-02-18|0x0101
//******                        constructor                            ******             //11-02-18|0x0102
//******                                                               ******             //11-02-18|0x0103
//***************************************************************************             //11-02-18|0x0104
//***************************************************************************             //11-02-18|0x0105
//*******************************************************************************         //10-29-97|0x0106
//*******************************************************************************         //10-29-97|0x0106
// CONSTRUCTOR                                                                            //11-02-18|0x0106
//*******************************************************************************         //10-29-97|0x0106
//*******************************************************************************         //10-29-97|0x0106
VERSION_REPORT::VERSION_REPORT() {                                                        //11-02-18|0x0106
//***************************************************************************             //11-02-18|0x0107
//***************************************************************************             //11-02-18|0x0108
    { ULONG i;                                                                            //11-02-18|0x0109
      test_samples[NoTestSamples] = TestIndex;                                            //11-02-18|0x0109
      i = 1;                                                                              //11-02-18|0x0109
      while(i<TestIndex)                                                                  //11-02-18|0x0109
        {                                                                                 //11-02-18|0x0109
          test_samples[i] = 0;                                                            //11-02-18|0x0109
          ++i;                                                                            //11-02-18|0x0109
          }                                                                               //11-02-18|0x0109
      }                                                                                   //11-02-18|0x0109
//***************************************************************************             //11-02-18|0x010a
}                                                                                         //11-02-18|0x010b
//                                                                                        //05-24-97|0x010b
//*******************************************************************************         //05-24-97|0x010f
//*******************************************************************************         //05-24-97|0x010f
//****                       END OF FILE                                     ****         //05-24-97|0x010f
//*******************************************************************************         //05-24-97|0x010f
//*******************************************************************************         //05-24-97|0x010f
